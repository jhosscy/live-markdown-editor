.markdown-editor {
  font-family: var(--font-family-primary);
  background-color: var(--color-surface);
  caret-color: var(--color-primary);
  border-top-left-radius: 1.35rem;
  border-top-right-radius: 1.35rem;
  outline: none;
  white-space: pre-wrap;
  height: 100%;
  padding: 1rem 1.125rem;
  box-shadow: var(--panel-shadow);
}

.markdown-editor:empty::before {
  content: attr(data-placeholder);
  color: var(--color-text-muted);
  pointer-events: none;
}

/* ============
   CONTENIDO HTML (render de marked.js)
   Estas reglas aplican a los elementos hijos y NO afectan al texto plano.
   ============ */

/* Asegurar tipografía/espaciado base en elementos de bloque */
.markdown-editor :where(p, ul, ol, blockquote, pre, table, hr, figure) {
  margin-block: 0.75rem;
  white-space: normal; /* anula el pre-wrap del contenedor para HTML real */
}

/* Quitar márgenes extra en extremos */
.markdown-editor > :first-child { margin-block-start: 0; }
.markdown-editor > :last-child  { margin-block-end: 0; }

/* Control de roturas largas (URLs, palabras muy largas) */
.markdown-editor :where(p, li, blockquote) {
  overflow-wrap: anywhere;
  word-break: break-word;
}

/* Encabezados */
.markdown-editor :where(h1, h2, h3, h4, h5, h6) {
  font-weight: 700;
  color: var(--color-text);
  line-height: 1.25;
  margin-block: 1rem 0.5rem;
  scroll-margin-top: 4.5rem; /* evita quedar tapado por el switch sticky */
}

.markdown-editor h1 { font-size: 1.875rem; } /* ~30px */
.markdown-editor h2 { font-size: 1.5rem;   } /* ~24px */
.markdown-editor h3 { font-size: 1.25rem;  } /* ~20px */
.markdown-editor h4 { font-size: 1.125rem; } /* ~18px */
.markdown-editor h5 { font-size: 1rem;     } /* ~16px */
.markdown-editor h6 { font-size: 0.875rem; } /* ~14px; ligeramente tenue */
.markdown-editor h6 { color: var(--color-text-muted); }

/* Párrafos */
.markdown-editor p { color: var(--color-text); }

/* Enlaces */
.markdown-editor a {
  color: var(--color-primary);
  text-decoration: underline;
  text-underline-offset: 0.15em;
  text-decoration-thickness: 0.075em;
}
.markdown-editor a:hover { color: var(--color-primary-hover); }
.markdown-editor a:focus-visible {
  outline: 2px solid var(--focus-ring);
  outline-offset: 2px;
  border-radius: 0.25rem;
}

/* Listas */
.markdown-editor ul { list-style: disc; padding-inline-start: 1.25rem; }
.markdown-editor ol { list-style: decimal; padding-inline-start: 1.25rem; }
.markdown-editor :where(li + li) { margin-block-start: 0.35rem; }
.markdown-editor ul ul { list-style: circle; }
.markdown-editor ul ul ul { list-style: square; }

/* Citas */
.markdown-editor blockquote {
  border-inline-start: 0.25rem solid var(--color-border);
  padding-inline: 0.875rem;
  padding-block: 0.25rem;
  color: var(--color-text-muted);
  background:
    color-mix(in oklab, var(--color-surface) 92%, black 8%);
  border-radius: 0.5rem;
}

/* Código en línea */
.markdown-editor code {
  font-family: var(--font-mono);
  font-size: 0.925em;
  background: color-mix(in oklab, var(--color-surface) 85%, white 15%);
  border: 1px solid var(--color-border);
  border-radius: 0.375rem;
  padding: 0.125em 0.375em;
  white-space: break-spaces;
}

/* Bloques de código */
.markdown-editor pre {
  background: color-mix(in oklab, var(--color-bg) 88%, white 12%);
  border: 1px solid var(--color-border);
  border-radius: 0.625rem;
  padding: 0.875rem 1rem;
  overflow: auto;
  line-height: 1.5;
}
.markdown-editor pre code {
  background: transparent;
  border: 0;
  border-radius: 0;
  padding: 0;
  white-space: pre; /* respetar formato del bloque */
}

/* Tablas */
.markdown-editor table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid var(--color-border);
  border-radius: 0.5rem;
  overflow: hidden;
  display: block;         /* responsive */
  overflow-x: auto;       /* scroll horizontal si hace falta */
}
.markdown-editor thead th {
  background: color-mix(in oklab, var(--color-surface) 80%, black 20%);
  color: var(--color-text);
}
.markdown-editor th,
.markdown-editor td {
  padding: 0.625rem 0.75rem;
  border-bottom: 1px solid var(--color-border);
  text-align: left;
  vertical-align: top;
}
.markdown-editor tbody tr:hover {
  background: color-mix(in oklab, var(--color-surface) 92%, white 8%);
}

/* Imágenes y figuras */
.markdown-editor img {
  max-width: 100%;
  height: auto;
  display: block;
  margin-inline: auto;
  border-radius: 0.5rem;
  box-shadow: 0 0.25rem 0.75rem oklch(0% 0 0 / 0.15);
}
.markdown-editor figure { margin-block: 1rem; }
.markdown-editor figcaption {
  color: var(--color-text-muted);
  font-size: 0.875rem;
  text-align: center;
  margin-top: 0.375rem;
}

/* Regla horizontal */
.markdown-editor hr {
  height: 1px;
  border: 0;
  background: var(--color-border);
  margin-block: 1.25rem;
}

/* Teclas (kbd) y resaltado (mark) */
.markdown-editor kbd {
  font-family: var(--font-mono);
  font-size: 0.85em;
  padding: 0.125em 0.375em;
  border: 1px solid var(--color-border);
  border-bottom-width: 2px;
  border-radius: 0.375rem;
  background: color-mix(in oklab, var(--color-surface) 82%, white 18%);
}
.markdown-editor mark {
  background: color-mix(in oklab, var(--color-primary) 35%, white 65%);
  color: var(--color-bg);
  border-radius: 0.25rem;
  padding: 0.05em 0.25em;
}

/* Superíndices/subíndices más legibles */
.markdown-editor :where(sup, sub) { font-size: 0.8em; }

/* Código/elementos enfocables accesibles */
.markdown-editor :where(code, pre, kbd):focus-visible {
  outline: 2px solid var(--focus-ring);
  outline-offset: 2px;
  border-radius: 0.5rem;
}

/* science */
.katex .text { font-family: var(--font-family-science); }
